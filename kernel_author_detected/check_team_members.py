import networkx as nx
import numpy as np
import tqdm
from pymongo import MongoClient


def check_file(path):
    leaders = ['1984838606', '2227253382', '2052472465', '2069524442', '2146258202', '2681328136', '38845618',
               '2101365550', '2249793398', '2163446446', '329910383', '2104653613', '2106222798', '2036349267',
               '2055799763', '2171310226', '2081353546']
    members = ['404565408', '2343632159', '2670944070', '2631790958', '2152507340', '2113246774', '2147185896',
               '1601293841', '2174985400', '2136556746', '2146115641', '29005305', '2051098434', '2893607809',
               '2126101459', '2561234346', '2122707581', '2682373867', '2667020052', '2152999232', '2893439602',
               '2932589500', '2683234669', '2163255317', '2466710729', '305618809', '2573551016', '2146115641',
               '2897769005', '2134014566', '2133983782', '2138640236', '2141739595', '2503224341', '2930518073',
               '2153421060', '2263964151', '2167032303', '2595570217', '2687156700', '2684724500', '2163368592',
               '2655439487', '2698120280', '2096543487', '2323386473', '2120169796', '2887548897', '2630277302',
               '2639120638', '2070575593', '2777743730', '2168613017', '2182886034', '57898110', '2330102650',
               '2196817303', '152887991', '1999508070', '132103621', '2066841051', '303613142', '2899091106',
               '2113477095', '2574630407', '2311769716', '2630370053', '2571009248', '2145160160', '1978803655',
               '1607253913', '2924136942', '1964156647', '2156010532', '2102478470', '2924935227', '2096095416',
               '218175561', '2365212314', '2119893020', '2107917670', '2006188770', '2206719268', '2128450755',
               '2198070710', '2808777917', '2103579519', '2681876608', '2010875763', '1971261289', '2100818546',
               '2046410517', '162253719', '2573645052', '2118029367', '2167096806', '2161983439', '2776195728',
               '2149341496', '2096627015', '2048157592', '229175834', '2111990228', '2122193271', '2683512592',
               '1988747110', '2096939186', '2642278050', '2129309438', '2636614612', '2303451173', '2635065094',
               '2304396750', '2666159266', '2166371674', '2099811583', '2107434590', '2149514797', '2680908996',
               '2225259531', '2168024214', '2157708780', '2798650010', '2198983026', '2226543658', '2101141533',
               '2100886215', '416104820', '1119718656', '2153496801', '2671665018', '2518530940', '2160150884',
               '2652217057', '2124091997', '2240690536', '2231782831', '1836339439', '1811224162', '2001793595']
    assistants = []
    postdocs = ['1975861307', '2026325584', '2228814312', '2924838121', '2095943436', '1128290216', '2161476513',
                '2558271738', '2168180808', '2307389109', '2303724852', '2803707736', '2917990815', '2424925839',
                '2134277328', '2219775466', '2463967093', '2167158302', '2128187218', '100375071', '2077180693',
                '2103351368', '2749903649', '2749976761', '2682727269', '2607834907', '2104945716']
    doctors = ['2147918188', '2345205178', '2118252886', '2141588545', '2128865582', '2425799484', '2752358457',
               '2608282721', '1266965569', '2560294467', '2042663857', '2738305129', '2097492187', '2933028805',
               '2625268406', '1983914940', '2214898855', '2443078652', '2149913060', '2700287723', '2022203600',
               '2782446841', '2781179173', '2255033872', '2205809501', '2596602368', '2398964917', '2097350334',
               '2485676506', '2694064971', '2667928597', '2604345531', '2788159515', '1978292022', '2139651645',
               '2139651645', '2121075360', '2122817130', '2304364831', '2104203371', '2160828216', '2343557966',
               '301914378', '2225682492', '2528370491', '917262090', '2763245920', '2000086078', '2708433550',
               '337396571', '2908307367', '2535016339', '2806089582', '2811340330', '2735618500']
    masters = ['2116456411', '2102002796', '2634174050', '2144965526', '1988254826', '102740216', '2129908635',
               '2568769829', '2133088636', '2580518003', '662858474', '2120864060', '2112232458', '2099118133',
               '2898141097', '2883385364', '2607216286', '2537250171', '2683972733', '2799967932', '2790068275',
               '2645108987', '2678184513', '2234747992', '2892137050', '2486156316', '2254229294', '2145091067',
               '2097449386', '2099560555', '2358414896', '2103181844', '2166225333', '2627438164', '2609556378',
               '2570704126', '2573643773', '2573643773', '2605989135', '2225682492', '2528370491', '917262090',
               '2763245920', '2000086078', '2706131936']
    alumnis = ['2120761920', '46106380', '2137039922', '283042521', '2478973563', '2608828817', '2118640023',
               '1923218030',
               '2108025540', '98894233', '2786135038', '2099301034', '1221626345', '2885856570', '38970831',
               '2628878818',
               '2161208487', '2892558305', '2088536091', '2656625994', '2163499725', '2234452589', '1603383808',
               '2102013811',
               '2607727389', '2303613998', '2276079446', '2681328136', '565878027', '2028266199', '373876587',
               '2528506410',
               '2650987650', '2628878818', '2885856570', '2474966271', '2160732037', '2097273326', '1973247951',
               '1999770807',
               '1354816936', '2762740081', '2798958267', '2014530249', '380014765', '2303718488', '2130665893',
               '2496684464',
               '2168841453', '2190065093', '2307618570', '2171612916', '2599631056', '2650943115', '2892798998',
               '2685828925',
               '2462341530', '2263778494', '2631946017', '2790179500', '2930008496', '2792601924', '2651058430',
               '2634792150',
               '2165482772', '2305543518', '2686615858', '2669810403', '2777588807', '2701453572', '2428770388',
               '2639347120',
               '2111360953', '2696592548', '2700043532', '2765096203', '2108928151', '2663032478', '2429888869',
               '2628571622',
               '2296433447', '2616561934', '2643659814', '2148573281', '2656066957', '2650938711', '2681987992',
               '2708982487',
               '2673596703', '2308764093', '2686615858', '2587431914', '2616561934', '2755397222', '2099118133',
               '2754904664',
               '2292540048', '2920464777', '2599411263', '2673828586', '2883385364', '2031838762', '1966707555',
               '2111218445',
               '2164965353', '1031839550', '2116956451', '2145095518', '380014765', '2303746224', '1944499404',
               '2135058405',
               '2761678767', '2358414896', '2922937925', '2618037599', '2114922421', '2110279758', '2708413883',
               '2488092641',
               '2702051385', '2234260472', '2192416783', '2687995922', '2235956210', '2184982114', '2021404014',
               '2311379535',
               '2043608195', '2092742661', '2601969657', '2917906060', '2590036756', '1843239838', '2093664028',
               '2153400383',
               '2694980694', '2431339895', '2300191317', '2024573934', '2159509338', '2164620433', '2098934872',
               '2147670869',
               '2306357273', '2745745895', '1988090614', '2095763615', '2575753754', '2615592390', '242385703',
               '2300552631',
               '2114746241', '2931302653', '2210743192', '2066208128', '2013206790', '1833090809', '2137432717',
               '2136004617',
               '2013771523', '2147859899', '221544955', '788080121', '2307251823', '2460225895', '2150786432',
               '2305122628',
               '2310236397', '2107761078', '2136593781', '2164499344', '2327759715', '2288795585', '2346787949',
               '2113813718',
               '2047561791', '2670485545', '2202853099', '2146993022', '1972901956', '2083817176', '2309866919',
               '2077766773',
               '2310568174', '2169729263', '2111786531', '2591060587', '2558271738', '2167546878', '2093607815',
               '2100191659',
               '2163028900', '1891944859', '2893140854', '2046107018', '1896847774', '2183833945', '2225734442',
               '2477261816',
               '2134765091', '2103579519', '2440012093', '2222803834', '2230062339', '2005485966', '2182041801',
               '2541203325',
               '2132615128', '2288913131', '2155451605', '2215949004', '297711364', '2147266155', '2102820239',
               '2076547627',
               '2129077364', '2423058546', '2306260897', '2145498347', '2067730168', '2633073089', '2112566403',
               '2302071190',
               '2736981059', '2405812664', '2655571811', '1245689326', '2233371350', '2107856776', '2221020175',
               '2690457040',
               '2642278050', '2277394921', '2303583372', '2636614612', '2635065094', '2701048582', '2097653865',
               '2312122676',
               '2420013409', '2495035196', '2694064971', '2303556036', '2493676941', '2637816835', '2111591513',
               '2629424063',
               '1988747110', '2636614612', '2129309438', '2303583372', '2103280417', '2635065094', '2666159266',
               '2304396750',
               '2212530998', '2226053727', '2616397971', '2145506593', '2128683105', '2691080598', '2172071796',
               '2144337244',
               '2121797826', '2226363402', '2166371674', '2107434590', '2804759263', '2804759263', '2416370509',
               '2708938150',
               '2442767405', '2324914564', '2694992530', '2666159266', '2310999502', '2168716058', '2172071796',
               '2227394013',
               '2302736171', '2805104779', '2550380291', '2120426649', '2614530281', '2485433341', '2283061575',
               '2305718927',
               '2323257001', '2680908996', '2225259531', '2780491112', '2660763088', '2529019787', '2919393546',
               '2634373288',
               '2594717567', '2708882055', '2660734614', '2691080598', '2303325710', '2892625957', '2159186115',
               '2485713002',
               '1422584695', '1787861840', '2126694903', '2151574249', '1982743242', '2150469586', '2150469586',
               '2129779547',
               '2735789512', '2161123335', '2152164708', '1980488834', '2066503697', '31390454', '1996512423',
               '2164968040',
               '2113165487', '2113165487', '2108641532', '2206899879', '1988556028', '2195679574', '2278294079',
               '2237328951',
               '1969377669', '2676701685', '2171689288', '2057065545', '2102100994', '2776420735', '2100143089',
               '2165004325',
               '223720365', '2800424027', '1878631932', '2228563131', '2682927300', '2168649741', '2738814177',
               '2176877039',
               '2112894965', '2220299576', '2160510735', '1834773024', '2246752162', '127401815', '2159823517',
               '1984456616',
               '2312146965', '1764326631', '678912235', '2213385919', '2417229859', '1489048449', '2099243581',
               '2034935985',
               '2109788593', '87460347', '1747408227', '2147247199', '2110385854', '2096651107', '2130754085',
               '2167258035',
               '2150833760', '2649179961', '2275864655', '2150663838', '2588683129', '2101048513', '325046544',
               '2205399161',
               '2150261957', '2127689019', '28143959', '2171668805', '2026751896', '2149435715', '2758949846',
               '2611554460',
               '2758032081', '2140436085', '2114757771', '2096598770', '2647128834', '2608432063', '2149435715',
               '2306754820',
               '2484057079', '2682687117', '80552714', '2892559261', '2628051876', '2124669283', '1966009211',
               '666632189',
               '2570135626', '2047336310', '2918103248', '1999552226', '2687065695', '2150130079', '1729528123',
               '2305656273',
               '2910042736', '2071071684', '1957339657', '1924262089', '2046687935', '2140907756', '2299514913',
               '2620260231',
               '1991606086', '1197965035', '2466749593', '2107736785', '2001727836', '2155642141', '2405433388',
               '70605372',
               '259655449', '2102902193', '2795037202', '2691929280', '2777528128', '2534132368', '2534132368',
               '2802020631',
               '2786175503', '2689289499', '2615792163', '2628813804', '2539067361', '2700361395', '2900474256',
               '2900847785',
               '2601127596', '2436792609', '2489420623', '1951375226', '2105273232', '2916217127', '2139755848',
               '2011793866',
               '2125565904', '2097440269', '2085857916', '2294752828', '2127585911', '2081353546', '2634960625',
               '2198295625',
               '2123919020', '2735618500', '2026534069', '2552041327', '1017840353', '1811224162', '2180628279',
               '2591786134']

    def net_details(graph, db_col):
        papers = []
        for i in tqdm.tqdm(graph.nodes()):
            id = int(i)
            pub_papers = db_col.find_one({'id': id})['pub_papers']
            for p in pub_papers:
                papers.append((p['id'], p['citationCnt']))
        papers = list(set(papers))
        # clique_number = nx.graph_number_of_cliques(graph)#clique_numbernx.average_shortest_path_length(graph),
        return (len(graph.nodes), len(graph.edges), len(papers), np.sum(np.array([p[1] for p in papers])))

    graph = nx.read_gml(path)
    nodes = list(graph.nodes)
    # edges = list(graph.edges)
    # print(len(nodes))
    client = MongoClient(host='172.21.201.187', port=27017)
    db_CCF = client.CCFgraph
    au_col = db_CCF.authors

    nodes_num, edges_num, papers, citacnt = net_details(graph, au_col)

    def check_num(role_list, top_nodes):
        num = 0
        for ro in role_list:
            if ro in top_nodes:
                num += 1
        return num

    learder_num = check_num(leaders, nodes)
    members_num = check_num(members, nodes)
    postdocs_num = check_num(postdocs, nodes)
    doctors_num = check_num(doctors, nodes)
    masters_num = check_num(masters, nodes)
    alumnis_num = check_num(alumnis, nodes)

    print(nodes_num, edges_num, papers, citacnt, learder_num, members_num, postdocs_num, doctors_num, masters_num,
          alumnis_num)


if __name__ == '__main__':
    # paths = [
    #     'allfield_mode_am_4hold_0.46.gml',
    #     'allfield_mode_cita_4hold_0.95.gml',
    #     'allfield_mode_dc_4hold_0.95.gml',
    #     'allfield_mode_Hindex_4hold_0.99.gml',
    #     'allfield_mode_paper_4hold_0.95.gml'
    # ]
    paths = [
        'allfield_mode_am_4hold_0.45.gml',
        'allfield_mode_am_4hold_0.5.gml',
        'allfield_mode_am_4hold_0.55.gml',
        'allfield_mode_am_4hold_0.6.gml',
        'allfield_mode_am_4hold_0.65.gml',
        'allfield_mode_am_4hold_0.7.gml',
        'allfield_mode_am_4hold_0.75.gml',
        'allfield_mode_am_4hold_0.8.gml',
        'allfield_mode_am_4hold_0.85.gml',
        'allfield_mode_am_4hold_0.9.gml',
        'allfield_mode_am_4hold_0.95.gml',
    ]
    for p in paths:
        file_path = '../core_author_net/{}'.format(p)
        check_file(file_path)
